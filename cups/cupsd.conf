# CUPS配置文件
# 允许远程访问和管理

LogLevel warn
MaxLogSize 1m

# 监听所有网络接口
Port 631
Listen /var/run/cups/cups.sock

# 启用Web界面
Browsing On
BrowseLocalProtocols dnssd

# 允许所有本地网络访问
<Location />
  Order allow,deny
  Allow @LOCAL
</Location>

# 允许管理员访问
<Location /admin>
  Order allow,deny
  Allow @LOCAL
</Location>

# 允许配置访问
<Location /admin/conf>
  AuthType Default
  Require user @SYSTEM
  Order allow,deny
  Allow @LOCAL
</Location>

# 允许打印作业访问
<Policy default>
  JobPrivateAccess default
  JobPrivateValues default
  SubscriptionPrivateAccess default
  SubscriptionPrivateValues default
  
  <Limit Create-Job Print-Job Print-URI Validate-Job>
    Order allow,deny
    Allow @LOCAL
  </Limit>
  
  <Limit Send-Document Send-URI Hold-Job Release-Job Restart-Job Purge-Jobs Set-Job-Attributes>
    Order allow,deny
    Require user @OWNER @SYSTEM
    Order deny,allow
  </Limit>
  
  <Limit Cancel-Job CANCEL-JOB>
    Order allow,deny
    Require user @OWNER @SYSTEM
    Order deny,allow
  </Limit>
  
  <Limit Pause-Printer Resume-Printer Enable-Printer Disable-Printer Pause-Printer-After-Current-Job Hold-New-Jobs Release-Held-New-Jobs Deactivate-Printer Activate-Printer Restart-Printer Shutdown-Printer Startup-Printer Promote-Job Schedule-Job-After Cancel-Jobs CANCEL-ALL-JOBS>
    AuthType Default
    Require user @SYSTEM
    Order deny,allow
  </Limit>
  
  <Limit Cancel-Jobs CANCEL-ALL-JOBS>
    AuthType Default
    Require user @SYSTEM
    Order deny,allow
  </Limit>
  
  <Limit All>
    Order deny,allow
  </Limit>
</Policy>

# 启用共享打印机
<Policy authenticated>
  <Limit Create-Job Print-Job Print-URI Validate-Job>
    AuthType Default
    Order deny,allow
  </Limit>
  
  <Limit Send-Document Send-URI Hold-Job Release-Job Restart-Job Purge-Jobs Set-Job-Attributes>
    AuthType Default
    Require user @OWNER @SYSTEM
    Order deny,allow
  </Limit>
  
  <Limit Cancel-Job CANCEL-JOB>
    AuthType Default
    Require user @OWNER @SYSTEM
    Order deny,allow
  </Limit>
  
  <Limit Pause-Printer Resume-Printer Enable-Printer Disable-Printer Pause-Printer-After-Current-Job Hold-New-Jobs Release-Held-New-Jobs Deactivate-Printer Activate-Printer Restart-Printer Shutdown-Printer Startup-Printer Promote-Job Schedule-Job-After Cancel-Jobs CANCEL-ALL-JOBS>
    AuthType Default
    Require user @SYSTEM
    Order deny,allow
  </Limit>
  
  <Limit Cancel-Jobs CANCEL-ALL-JOBS>
    AuthType Default
    Require user @SYSTEM
    Order deny,allow
  </Limit>
  
  <Limit All>
    Order deny,allow
  </Limit>
</Policy>

# 启用USB打印机自动检测
DeviceURI usb:/dev/usb/lp0
